{% extends "base.html" %}

{% block title %}Deliveries - Eman Bakery{% endblock %}

{% block content %}
<div class="card">
    <h2>Schedule New Delivery</h2>
    <form action="/api/deliveries" method="POST">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label for="customer_id">Customer *</label>
                <select id="customer_id" name="customer_id" required>
                    <option value="">Select customer...</option>
                    {% for customer in customers %}
                    <option value="{{ customer.id }}">{{ customer.name }}{% if customer.business_name %} - {{ customer.business_name }}{% endif %}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="product_id">Product *</label>
                <select id="product_id" name="product_id" required>
                    <option value="">Select product...</option>
                    {% for product in products %}
                    <option value="{{ product.id }}">{{ product.name }} - ${{ "%.2f" | format(product.price) }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="quantity">Quantity *</label>
                <input type="number" id="quantity" name="quantity" required placeholder="0">
            </div>
            <div class="form-group">
                <label for="delivery_date">Delivery Date *</label>
                <input type="date" id="delivery_date" name="delivery_date" required>
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" placeholder="Special instructions or notes..."></textarea>
            </div>
        </div>
        <button type="submit" class="btn">Schedule Delivery</button>
    </form>
</div>

<div class="card">
    <h2>Delivery Schedule</h2>
    {% if deliveries %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Customer</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Delivery Date</th>
                <th>Status</th>
                <th>Notes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for delivery in deliveries | reverse %}
            <tr>
                <td>#{{ delivery.id }}</td>
                <td>
                    {% for customer in customers %}
                        {% if customer.id == delivery.customer_id %}
                            <strong>{{ customer.name }}</strong>
                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                    {% for product in products %}
                        {% if product.id == delivery.product_id %}
                            {{ product.name }}
                        {% endif %}
                    {% endfor %}
                </td>
                <td>{{ delivery.quantity }}</td>
                <td>{{ delivery.delivery_date }}</td>
                <td>
                    <span class="badge badge-{{ delivery.status }}">{{ delivery.status | upper }}</span>
                </td>
                <td>{{ delivery.notes or '-' }}</td>
                <td>
                    {% if delivery.status == 'pending' %}
                    <form action="/api/deliveries/{{ delivery.id }}/status" method="POST" style="display: inline;">
                        <input type="hidden" name="status" value="completed">
                        <button type="submit" class="btn btn-success" style="padding: 0.5rem 1rem; font-size: 0.85rem;">Complete</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No deliveries scheduled yet. Schedule your first delivery above!</p>
    </div>
    {% endif %}
</div>
{% endblock %}
